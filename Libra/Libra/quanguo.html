<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">

  <title>MapTest</title>
  <link rel="stylesheet" href="css/jquery.spinner.css" />
<script type="text/javascript" src="http://libs.useso.com/js/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.spinner.js"></script>
    <script type="text/javascript" src="js/jquery.simple-color.js"></script>
    <script src="js/prefixfree.min.js"></script>
    <script type="text/javascript">
    dojoConfig = {
        parseOnLoad: true,
        packages: [{
            name: 'tdlib',
            location:"/js/tdlib"
        }]
    };
    </script>
    <link rel="stylesheet" href="http://js.arcgis.com/3.6/js/esri/css/esri.css">
    <link rel="stylesheet" href="http://js.arcgis.com/3.6/js/dojo/dijit/themes/tundra/tundra.css">
    <script src="http://js.arcgis.com/3.6/"></script>


    

</head>

<body >
    <div class="wrapper" style="z-index:100">
        <ul>
            <li>
                <p>图层选择:</p>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="layer" /> <span>动态比例尺中国地质图</span>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="25w" /> <span>1:25万中国地质图</span>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="50w" /> <span>1:50万中国地质图</span>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="100w" /> <span>1:100万中国地质图</span>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="250w" /> <span>1:250万中国地质图</span>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="500w" /> <span>1:500万中国地质图</span>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="500aw" /> <span>1:500万亚洲地质图</span>
            </li>
            <li>
                <input type="checkbox" name="check-box" id="7500w" /> <span>1:7500万全球构造分布图</span>
            </li>
            <li>
                <input type="text" class="spinner" />
            </li>
            <li>
                <h3>选择颜色</h3>
                <input class='simple_color_callback' value='#cc3333' />
            </li>
            <li>
                <input type="button" value="确定" onclick="Csscheck()" style="width:30px;height:auto" />
            </li>
            <li>
                <input type="button" value="画线" onclick="Polyline()" style="width:30px;height:auto" />
            </li>
        </ul>
       
    </div>
    <div id="map" style="height:1300px;width:1600px;z-index:10" ></div>
    <script type="text/javascript">
    var reg = /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;
    var map, mylayer;
    var color;
    var line = 1;
    var sRgbColors = "0,0,0";
    require(["esri/map",
        "tdlib/TDTLayer",
        "tdlib/TDTAnnoLayer",
        "esri/layers/WMSLayer",
        "esri/layers/FeatureLayer",
        "esri/geometry/Extent",
        "esri/geometry/Point",
        "esri/toolbars/draw",
        "esri/graphic",
        "esri/SpatialReference",
        "esri/symbols/SimpleFillSymbol",
        "esri/symbols/SimpleLineSymbol",
        "dojo/_base/Color",
        "dojo/domReady!"],
    function (Map,
         TDTLayer,
         TDTAnnoLayer,
         WMSLayer,
         SpatialReference,
         FeatureLayer,
         Point,
         Draw,
         Graphic,
         Extent,
         SimpleFillSymbol,
         SimpleLineSymbol,
         Color
    ) {
        map = new Map("map", { logo: false });
        var basemap = new TDTLayer();
        map.addLayer(basemap);
        var annolayer = new TDTAnnoLayer();
        map.addLayer(annolayer);
        navDraw = new Draw(map);
      //  navDraw.on("draw-end", addToMap);
    
        dojo.connect(navDraw, "onDrawEnd", doMeasure);      
         
        
        dojo.declare("Mylayer", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS10A52299999/WMTSServer/1.0.0/TAS10A52299999/default/TAS10A52299999_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer = new Mylayer();
        map.addLayer(Mylayer);
       

        dojo.declare("Mylayer25", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS10C52000000/WMTSServer/1.0.0/TAS10C52000000/default/TAS10C52000000_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer25 = new Mylayer25();
       

        dojo.declare("Mylayer50", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS10B52000000/WMTSServer/1.0.0/TAS10B52000000/default/TAS10B52000000_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer50 = new Mylayer50();
       

        dojo.declare("Mylayer100", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS10A52000000/WMTSServer/1.0.0/TAS10A52000000/default/TAS10A52000000_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer100 = new Mylayer100();
       

        dojo.declare("Mylayer250", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS10M52000000/WMTSServer/1.0.0/TAS10M52000000/default/TAS10M52000000_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer250 = new Mylayer250();
        

        dojo.declare("Mylayer500", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS10P52100244/WMTSServer/1.0.0/TAS10P52100244/default/TAS10P52100244_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer500 = new Mylayer500();
        

        dojo.declare("Mylayer500a", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS10P52200300/WMTSServer/1.0.0/TAS10P52200300/default/TAS10P52200300_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer500a = new Mylayer500a();
       

        dojo.declare("Mylayer7500", TDTLayer, {
            getTileUrl: function (level, row, col) {
                return "http://219.142.81.86/igserver/ogc/kvp/TAS60S52100040/WMTSServer/1.0.0/TAS60S52100040/default/TAS60S52100040_TMS/" + (level - 1) + "/" + row + "/" + col + ".png";
            }
        });
        Mylayer7500 = new Mylayer7500();
           

        var pt = new Point(103.847, 36.0473);
        map.centerAndZoom(pt, 2);    
    });

    $('#layer').on('click', function () {
        var c = $('#layer').is(':checked');
        if (c) { map.addLayer(Mylayer); }
        else { map.removeLayer(Mylayer); }
    });

    $('#25w').on('click', function () { 
        var c = $('#25w').is(':checked');
        if (c) { map.addLayer(Mylayer25); }
        else { map.removeLayer(Mylayer25); }
    });
    $('#50w').on('click', function () {
        var c = $('#50w').is(':checked');
        if (c) { map.addLayer(Mylayer50); }
        else { map.removeLayer(Mylayer50); }
    });
    $('#100w').on('click', function () {
        var c = $('#100w').is(':checked');
        if (c) { map.addLayer(Mylayer100); }
        else { map.removeLayer(Mylayer100); }
    });
    $('#250w').on('click', function () {
        var c = $('#250w').is(':checked');
        if (c) { map.addLayer(Mylayer250); }
        else { map.removeLayer(Mylayer250); }
    });
    $('#500w').on('click', function () {
        var c = $('#500w').is(':checked');
        if (c) { map.addLayer(Mylayer500); }
        else { map.removeLayer(Mylayer500); }
    });
    $('#500aw').on('click', function () {
        var c = $('#500aw').is(':checked');
        if (c) { map.addLayer(Mylayer500a);map.setZoom(2) }
        else {
            map.removeLayer(Mylayer500a); map.setZoom(3);
            var pt = new Point(103.847, 36.0473);
            map.centerAndZoom(pt, 2);
        }
    });
    $('#7500w').on('click', function () {
        var c = $('#7500w').is(':checked');
        if (c) { map.addLayer(Mylayer7500); map.setZoom(1); }
        else {
            map.removeLayer(Mylayer7500); map.setZoom(3);
            var pt = new Point(103.847, 36.0473);
            map.centerAndZoom(pt, 2);
        }
    });

    $('sx').on('click', function () {
        var c = $('#sx').is(':checked');
        if (c) {
            dojo.connect(map, "click", myOnClickHandler);
        } else { }
    });


    function doMeasure(geometry) {
        //更加类型设置显示样式
        measuregeometry = geometry;
        navDraw.deactivate();
        switch (geometry.type) {
            case "point":
                var symbol = new esri.symbol.SimpleMarkerSymbol(
                    esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,    // 样式,STYLE_CIRCLE(●),STYLE_CROSS(+),STYLE_DIAMOND(◆),STYLE_SQUARE(■),STYLE_X(X)  
                    10, // 像素  
                    new esri.symbol.SimpleLineSymbol(
                        esri.symbol.SimpleLineSymbol.STYLE_SOLID,  // 样式,STYLE_DASH(破折号),STYLE_DASHDOT(点划线),STYLE_DASHDOTDOT,STYLE_DOT(点),STYLE_NULL,STYLE_SOLID(实线)  
                        new dojo.Color([0, 0, 255]),  // 颜色  
                        2  // 像素  
                    ),
                    new dojo.Color([255, 255, 255, 0.25])  // 颜色和透明度  
                );
                break;
            case "polyline":
                var symbol = new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color(color), line);
                break;
            case "polygon":
                var symbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([0, 0, 255]), 2), new dojo.Color([0, 0, 255, 0.25]));
                break;
            case "extent":
                var symbol = new esri.symbol.SimpleFillSymbol(
                    esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                    new esri.symbol.SimpleLineSymbol(
                        esri.symbol.SimpleLineSymbol.STYLE_SOLID,
                        new dojo.Color([0, 0, 255]),
                        2
                    ),
                    new dojo.Color([255, 255, 0, 0.25])
                );
                break;
            case "multipoint":
                var symbol = new esri.symbol.SimpleMarkerSymbol(
                    esri.symbol.SimpleMarkerSymbol.STYLE_SOLID,
                    12,
                    new esri.symbol.SimpleLineSymbol(
                        esri.symbol.SimpleLineSymbol.STYLE_SOLID,
                        new dojo.Color([0, 0, 255]),
                        2
                    ),
                    new dojo.Color([255, 255, 255, 0.5])
                );
                break;
        }
        //设置样式
        var graphic = new esri.Graphic(geometry, symbol);
        //清除上一次的画图内容
        // map.graphics.clear();
        map.graphics.add(graphic);
        //进行投影转换，完成后调用projectComplete
    }

    function addToMap(evt) {
        var symbol;
        navDraw.deactivate();
        map.showZoomSlider();
        switch (evt.geometry.type) { 
            case "polyline":
                symbol = new esri.symbol.SimpleLineSymbol();
                break;    
        }
        var graphic = new esri.Graphic(evt.geometry, symbol);
        map.graphics.add(graphic);
    }
    
    function Polyline() {
        navDraw.activate(esri.toolbars.Draw.POLYLINE);       
    }

    function Csscheck() {
        color = sRgbColors.split(",");
        line = $('.spinner').spinner("value");
        alert("样式确定");
    }

    $('.spinner').spinner();
    $('.simple_color_callback').simpleColor({
        onSelect: function (hex, element) {
            var sHex = "#" + hex;
            sRgbColors = sHex.colorRgb();
            alert("You selected #" + sRgbColors + " for input #" + element.attr('class'));
        }
    });
    String.prototype.colorRgb = function () {
        var sColor = this.toLowerCase();
        if (sColor && reg.test(sColor)) {
            if (sColor.length === 4) {
                var sColorNew = "#";
                for (var i = 1; i < 4; i += 1) {
                    sColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));
                }
                sColor = sColorNew;
            }
            //处理六位的颜色值  
            var sColorChange = [];
            for (var i = 1; i < 7; i += 2) {
                sColorChange.push(parseInt("0x" + sColor.slice(i, i + 2)));
            }
            return  sColorChange.join(",");
        } else {
            return sColor;
        }
    }
   
    </script>
   
    
   
</body>

</html>